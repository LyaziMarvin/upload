<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Record Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #eaf4fc;
      font-family: Arial, sans-serif;
      margin: 0;
    }
    .sidebar {
      background-color: #1a3d5d;
      color: white;
      height: 100vh;
      padding: 20px;
    }
    .sidebar h5 {
      margin-bottom: 1.5rem;
    }
    .sidebar button {
      width: 100%;
      margin-bottom: 10px;
    }
    .main-panel {
      padding: 20px;
    }
    .header {
      background-color: #205081;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }
    .field {
      margin-bottom: 8px;
    }
    .label {
      font-weight: bold;
    }
    .pill {
      display: inline-block;
      background: #e1e8f0;
      padding: 6px 10px;
      border-radius: 20px;
      margin: 3px 6px 3px 0;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      
      <!-- Sidebar -->
      <div class="col-md-3 sidebar">
        <h5><strong>Jones Family Record</strong></h5>
        <button class="btn btn-outline-light" onclick="showSection('profile')">üë§ Profile</button>
        <button class="btn btn-outline-light" onclick="showSection('relationships')">üë™ Relationships</button>
        <button class="btn btn-outline-light" onclick="showSection('medical')">ü©∫ Medical</button>
        <button class="btn btn-outline-light" onclick="showSection('timeline')">üìÖ Timeline</button>
        <button class="btn btn-outline-light" onclick="showSection('forgotten')">üß≥ Forgotten Items</button>
        <button class="btn btn-outline-warning" onclick="showSection('qa')">üí¨ Ask a Question</button>
        <a href="index.html" class="btn btn-danger mt-auto">‚Üê Back to Dashboard</a>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 main-panel">
        <div class="header">
          <h4 id="sectionTitle">üë§ Profile</h4>
        </div>
        <div id="recordContainer">
          <div id="profile" class="card"></div>
          <div id="relationships" class="card hidden"></div>
          <div id="medical" class="card hidden"></div>
          <div id="timeline" class="card hidden"></div>
          <div id="forgotten" class="card hidden"></div>

          <!-- Q&A Section -->
          <div id="qa" class="card hidden">
            <h4>üí¨ Ask About This Record</h4>
            <textarea id="questionInput" rows="4" class="form-control" placeholder="e.g. Who is the mentor?"></textarea>
            <button class="btn btn-primary mt-2" id="askButton">Ask</button>
            <div id="answer" class="mt-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function showSection(id) {
      const titles = {
        profile: "üë§ Profile",
        relationships: "üë™ Relationships",
        medical: "ü©∫ Medical",
        timeline: "üìÖ Timeline",
        forgotten: "üß≥ Forgotten Items",
        qa: "üí¨ Ask About This Record"
      };
      document.querySelectorAll('#recordContainer > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.getElementById('sectionTitle').textContent = titles[id];
    }

    function renderField(label, value) {
      return `<div class="field"><span class="label">${label}:</span> ${value ?? "N/A"}</div>`;
    }

    function renderList(list) {
      return `<ul>${list.map(item => `<li>${item}</li>`).join("")}</ul>`;
    }

    async function loadRecord() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) {
        document.getElementById("recordContainer").innerHTML = "‚ùå No ID provided.";
        return;
      }

      try {
        const res = await fetch("/records", {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}` // Passing token for authentication
          }
        });

        const records = await res.json();
        const record = records.find(r => r.id === id);
        if (!record) throw new Error("Record not found");

        const data = JSON.parse(record.json);
        document.getElementById("profile").innerHTML = `
          <h4>üë§ Profile</h4>
          ${renderField("Full Name", data.full_name)}
          ${renderField("Age", data.age)}
          ${renderField("Marital Status", data.marital_status)}
          ${renderField("Occupation", data.occupation)}
          ${renderField("Email", data.email)}
          ${renderField("Phone", data.phonenumber)}
        `;

        // Render other sections here like relationships, medical records, etc.
        // You can add similar renderField calls for relationships, medical records, timeline, etc.

      } catch (err) {
        document.getElementById("recordContainer").innerHTML = `<p class="text-danger">‚ùå Error loading record.</p>`;
      }
    }

    loadRecord();
  </script>
</body>
</html>
